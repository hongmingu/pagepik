<!DOCTYPE html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Demo</title>
    {% include 'others/header_static.html' %}
    {% include 'others/favicon.html' %}

    {% load static from staticfiles %}
    <script src="{% static 'js/navbar.js' %}"></script>
    <script src="{% static 'js/a_selected.js' %}"></script>
    <script src="{% static 'js/nav_badge.js' %}"></script>

    <script src="{% static 'js/date_differ.js' %}"></script>

    <link href="https://fonts.googleapis.com/css?family=Tauri" rel="stylesheet">
    {% if user.is_authenticated %}
    {% else %}
    {% endif %}

    <style>
    </style>


</head>
<body class="light_background_color height_100">
<!--navbar start-->
{% include 'baseapp/_navbar.html' %}

<!--navbar end-->
<!--page info-->
{% include 'others/bootstrap_tester.html' %}
<div class="hidden" id="search_word">{{ word }}</div>
<div class="hidden" id="order">0</div>
{% if user.is_authenticated %}
    <div class="hidden" id="user_id">{{ user.username }}</div>
{% else %}
    <div class="hidden" id="user_id"></div>
{% endif %}
<!--page info end -->
<div class="container-fluid margin_top_50">
    <div class="row">
        <div class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4">
            <div class="row">
                <div class="h3">keyword result</div>
                <div id="content_result"></div>
                <a href="">
                    <div class="hidden clickable more_load" align="center" id="more_load">more load</div>
                </a>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    $(function () {
        if ($('#search_word').html() === '') {
            $('#content_result').append('<div class="h4">no results</div>')
        } else {
            $.ajax({
                url: '/re/search/keyword/', type: 'post', dataType: 'json', cache: false,
                data: {
                    search_word: $('#search_word').html(),
                    order: $('#order').html()
                },
                success: function (data) {
                    console.log(data)
                    if (data.res === 1) {
                        //user set
                        if (data.output.length === 0) {
                            $('#content_result').append('<div class="h4">end results</div>')

                        } else {
                            $.each(data.output, function (key, value) {
                                var appender = '<div>' +
                                    '<a href="/search/all/?q=' + value + '">' +
                                    '<span class="search_keyword">' + value + '</span>' +
                                    '</a>' +
                                    '</div>'
                                $('#content_result').append(appender)
                            })
                        }

                        if (data.end === "true") {
                            $('#more_load').addClass('hidden')
                        } else if (data.end === "false") {
                            $('#more_load').removeClass('hidden')
                        }
                        $('#order').html(data.order)
                    }


                }
            })
        }

        $('#more_load').on('click', function (e) {
            e.preventDefault()
            $.ajax({
                url: '/re/search/keyword/', type: 'post', dataType: 'json', cache: false,
                data: {
                    search_word: $('#search_word').html(),
                    order: $('#order').html()
                },
                success: function (data) {
                    console.log(data)
                    if (data.res === 1) {
                        //user set
                        if (data.output.length === 0) {
                            $('#content_result').append('<div class="h4">end results</div>')

                        } else {
                            $.each(data.output, function (key, value) {
                                var appender = '<div>' +
                                    '<a href="/search/all/?q=' + value + '">' +
                                    '<span class="search_keyword">' + value + '</span>' +
                                    '</a>' +
                                    '</div>'
                                $('#content_result').append(appender)
                            })
                        }

                        if (data.end === "true") {
                            $('#more_load').addClass('hidden')
                        } else if (data.end === "false") {
                            $('#more_load').removeClass('hidden')
                        }
                        $('#order').html(data.order)
                    }


                }
            })
        })


    })
</script>
</html>